<!-- web/index.html -->
<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <title>Gestor Neto Contabilidade</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell; margin: 24px; }
      button { padding: 8px 12px; border-radius: 8px; border: 1px solid #ccc; cursor: pointer; }
      .row { display: flex; gap: 12px; align-items: center; }
      .card { padding: 12px; border: 1px solid #eee; border-radius: 10px; margin: 8px 0; }
      code { background: #f6f8fa; padding: 2px 6px; border-radius: 6px; }
    </style>
  </head>
  <body>
    <h1>Gestor Neto Contabilidade</h1>
    <div class="row">
      <button id="btnSync">ðŸ”„ Atualizar agora</button>
      <span id="meta"></span>
    </div>

    <h3>Processos (Ãºltimos 10)</h3>
    <div id="list"></div>

    <script>
      const API = location.origin + "/api";

      async function loadMeta() {
        const r = await fetch(`${API}/meta`);
        const j = await r.json();
        const last = j?.meta?.lastSync ?? "â€”";
        document.getElementById("meta").textContent = `Ãšltima sync: ${last}`;
      }

      async function loadProcesses() {
        const r = await fetch(`${API}/processes?take=10`);
        const j = await r.json();
        const host = document.getElementById("list");
        host.innerHTML = "";
        (j.rows ?? []).forEach((p) => {
          const div = document.createElement("div");
          div.className = "card";
          div.innerHTML = `
            <div><b>${p.title ?? p.idAcessorias ?? p.id}</b></div>
            <div>Status: <code>${p.status ?? "â€”"}</code></div>
            <div>Empresa: ${p.company?.nome ?? "â€”"}</div>
            <div>Atualizado: ${p.updatedAt ?? "â€”"}</div>
          `;
          host.appendChild(div);
        });
      }

      document.getElementById("btnSync").addEventListener("click", async () => {
        const btn = document.getElementById("btnSync");
        btn.disabled = true; btn.textContent = "Atualizandoâ€¦";
        try {
          await fetch(`${API}/sync`, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ full: false }) });
          await loadMeta();
          await loadProcesses();
        } finally {
          btn.disabled = false; btn.textContent = "ðŸ”„ Atualizar agora";
        }
      });

      // boot
      loadMeta();
      loadProcesses();
    </script>
  </body>
</html>
